#include <catch2/catch.hpp>
#include <fastpathways.h>
#include <map>
#include <string>
#include <cstdio>
#include <cstdlib>
#include <iostream>
#include <chrono>

using namespace std::chrono;

static auto const table = std::map<std::string, int64_t>{
    {"a", 0},
    {"b", 0},
    {"aa", 1},
    {"ab", 1},
    {"ba", 1},
    {"bb", 1},
    {"aaa", 2},
    {"aab", 2},
    {"aba", 2},
    {"abb", 2},
    {"baa", 2},
    {"bab", 2},
    {"bba", 2},
    {"bbb", 2},
    {"aaaa", 2},
    {"aaab", 3},
    {"aaba", 3},
    {"aabb", 3},
    {"abaa", 3},
    {"abab", 2},
    {"abba", 3},
    {"abbb", 3},
    {"baaa", 3},
    {"baab", 3},
    {"baba", 2},
    {"babb", 3},
    {"bbaa", 3},
    {"bbab", 3},
    {"bbba", 3},
    {"bbbb", 2},
    {"aaaaa", 3},
    {"aaaab", 3},
    {"aaaba", 4},
    {"aaabb", 4},
    {"aabaa", 3},
    {"aabab", 3},
    {"aabba", 4},
    {"aabbb", 4},
    {"abaaa", 4},
    {"abaab", 3},
    {"ababa", 3},
    {"ababb", 3},
    {"abbaa", 4},
    {"abbab", 3},
    {"abbba", 4},
    {"abbbb", 3},
    {"baaaa", 3},
    {"baaab", 4},
    {"baaba", 3},
    {"baabb", 4},
    {"babaa", 3},
    {"babab", 3},
    {"babba", 3},
    {"babbb", 4},
    {"bbaaa", 4},
    {"bbaab", 4},
    {"bbaba", 3},
    {"bbabb", 3},
    {"bbbaa", 4},
    {"bbbab", 4},
    {"bbbba", 3},
    {"bbbbb", 3},
    {"aaaaaa", 3},
    {"aaaaab", 4},
    {"aaaaba", 4},
    {"aaaabb", 4},
    {"aaabaa", 4},
    {"aaabab", 4},
    {"aaabba", 5},
    {"aaabbb", 5},
    {"aabaaa", 4},
    {"aabaab", 3},
    {"aababa", 4},
    {"aababb", 4},
    {"aabbaa", 4},
    {"aabbab", 4},
    {"aabbba", 5},
    {"aabbbb", 4},
    {"abaaaa", 4},
    {"abaaab", 4},
    {"abaaba", 3},
    {"abaabb", 4},
    {"ababaa", 4},
    {"ababab", 3},
    {"ababba", 4},
    {"ababbb", 4},
    {"abbaaa", 5},
    {"abbaab", 4},
    {"abbaba", 4},
    {"abbabb", 3},
    {"abbbaa", 5},
    {"abbbab", 4},
    {"abbbba", 4},
    {"abbbbb", 4},
    {"baaaaa", 4},
    {"baaaab", 4},
    {"baaaba", 4},
    {"baaabb", 5},
    {"baabaa", 3},
    {"baabab", 4},
    {"baabba", 4},
    {"baabbb", 5},
    {"babaaa", 4},
    {"babaab", 4},
    {"bababa", 3},
    {"bababb", 4},
    {"babbaa", 4},
    {"babbab", 3},
    {"babbba", 4},
    {"babbbb", 4},
    {"bbaaaa", 4},
    {"bbaaab", 5},
    {"bbaaba", 4},
    {"bbaabb", 4},
    {"bbabaa", 4},
    {"bbabab", 4},
    {"bbabba", 3},
    {"bbabbb", 4},
    {"bbbaaa", 5},
    {"bbbaab", 5},
    {"bbbaba", 4},
    {"bbbabb", 4},
    {"bbbbaa", 4},
    {"bbbbab", 4},
    {"bbbbba", 4},
    {"bbbbbb", 3},
    {"aaaaaaa", 4},
    {"aaaaaab", 4},
    {"aaaaaba", 5},
    {"aaaaabb", 5},
    {"aaaabaa", 4},
    {"aaaabab", 5},
    {"aaaabba", 5},
    {"aaaabbb", 5},
    {"aaabaaa", 4},
    {"aaabaab", 4},
    {"aaababa", 5},
    {"aaababb", 5},
    {"aaabbaa", 5},
    {"aaabbab", 5},
    {"aaabbba", 6},
    {"aaabbbb", 5},
    {"aabaaaa", 4},
    {"aabaaab", 4},
    {"aabaaba", 4},
    {"aabaabb", 4},
    {"aababaa", 5},
    {"aababab", 4},
    {"aababba", 5},
    {"aababbb", 5},
    {"aabbaaa", 5},
    {"aabbaab", 4},
    {"aabbaba", 5},
    {"aabbabb", 4},
    {"aabbbaa", 5},
    {"aabbbab", 5},
    {"aabbbba", 5},
    {"aabbbbb", 5},
    {"abaaaaa", 5},
    {"abaaaab", 5},
    {"abaaaba", 4},
    {"abaaabb", 5},
    {"abaabaa", 4},
    {"abaabab", 4},
    {"abaabba", 5},
    {"abaabbb", 5},
    {"ababaaa", 5},
    {"ababaab", 4},
    {"abababa", 4},
    {"abababb", 4},
    {"ababbaa", 5},
    {"ababbab", 4},
    {"ababbba", 5},
    {"ababbbb", 5},
    {"abbaaaa", 5},
    {"abbaaab", 5},
    {"abbaaba", 5},
    {"abbaabb", 4},
    {"abbabaa", 5},
    {"abbabab", 4},
    {"abbabba", 4},
    {"abbabbb", 4},
    {"abbbaaa", 6},
    {"abbbaab", 5},
    {"abbbaba", 5},
    {"abbbabb", 4},
    {"abbbbaa", 5},
    {"abbbbab", 5},
    {"abbbbba", 5},
    {"abbbbbb", 4},
    {"baaaaaa", 4},
    {"baaaaab", 5},
    {"baaaaba", 5},
    {"baaaabb", 5},
    {"baaabaa", 4},
    {"baaabab", 5},
    {"baaabba", 5},
    {"baaabbb", 6},
    {"baabaaa", 4},
    {"baabaab", 4},
    {"baababa", 4},
    {"baababb", 5},
    {"baabbaa", 4},
    {"baabbab", 5},
    {"baabbba", 5},
    {"baabbbb", 5},
    {"babaaaa", 5},
    {"babaaab", 5},
    {"babaaba", 4},
    {"babaabb", 5},
    {"bababaa", 4},
    {"bababab", 4},
    {"bababba", 4},
    {"bababbb", 5},
    {"babbaaa", 5},
    {"babbaab", 5},
    {"babbaba", 4},
    {"babbabb", 4},
    {"babbbaa", 5},
    {"babbbab", 4},
    {"babbbba", 5},
    {"babbbbb", 5},
    {"bbaaaaa", 5},
    {"bbaaaab", 5},
    {"bbaaaba", 5},
    {"bbaaabb", 5},
    {"bbaabaa", 4},
    {"bbaabab", 5},
    {"bbaabba", 4},
    {"bbaabbb", 5},
    {"bbabaaa", 5},
    {"bbabaab", 5},
    {"bbababa", 4},
    {"bbababb", 5},
    {"bbabbaa", 4},
    {"bbabbab", 4},
    {"bbabbba", 4},
    {"bbabbbb", 4},
    {"bbbaaaa", 5},
    {"bbbaaab", 6},
    {"bbbaaba", 5},
    {"bbbaabb", 5},
    {"bbbabaa", 5},
    {"bbbabab", 5},
    {"bbbabba", 4},
    {"bbbabbb", 4},
    {"bbbbaaa", 5},
    {"bbbbaab", 5},
    {"bbbbaba", 5},
    {"bbbbabb", 4},
    {"bbbbbaa", 5},
    {"bbbbbab", 5},
    {"bbbbbba", 4},
    {"bbbbbbb", 4},
    {"aaaaaaaa", 3},
    {"aaaaaaab", 5},
    {"aaaaaaba", 5},
    {"aaaaaabb", 5},
    {"aaaaabaa", 5},
    {"aaaaabab", 5},
    {"aaaaabba", 6},
    {"aaaaabbb", 6},
    {"aaaabaaa", 5},
    {"aaaabaab", 4},
    {"aaaababa", 5},
    {"aaaababb", 6},
    {"aaaabbaa", 5},
    {"aaaabbab", 6},
    {"aaaabbba", 6},
    {"aaaabbbb", 5},
    {"aaabaaaa", 5},
    {"aaabaaab", 4},
    {"aaabaaba", 5},
    {"aaabaabb", 5},
    {"aaababaa", 5},
    {"aaababab", 5},
    {"aaababba", 6},
    {"aaababbb", 6},
    {"aaabbaaa", 5},
    {"aaabbaab", 5},
    {"aaabbaba", 6},
    {"aaabbabb", 5},
    {"aaabbbaa", 6},
    {"aaabbbab", 6},
    {"aaabbbba", 6},
    {"aaabbbbb", 6},
    {"aabaaaaa", 5},
    {"aabaaaab", 4},
    {"aabaaaba", 4},
    {"aabaaabb", 5},
    {"aabaabaa", 4},
    {"aabaabab", 4},
    {"aabaabba", 5},
    {"aabaabbb", 5},
    {"aababaaa", 5},
    {"aababaab", 4},
    {"aabababa", 5},
    {"aabababb", 5},
    {"aababbaa", 6},
    {"aababbab", 5},
    {"aababbba", 6},
    {"aababbbb", 6},
    {"aabbaaaa", 5},
    {"aabbaaab", 5},
    {"aabbaaba", 5},
    {"aabbaabb", 4},
    {"aabbabaa", 6},
    {"aabbabab", 5},
    {"aabbabba", 5},
    {"aabbabbb", 5},
    {"aabbbaaa", 6},
    {"aabbbaab", 5},
    {"aabbbaba", 6},
    {"aabbbabb", 5},
    {"aabbbbaa", 5},
    {"aabbbbab", 6},
    {"aabbbbba", 6},
    {"aabbbbbb", 5},
    {"abaaaaaa", 5},
    {"abaaaaab", 5},
    {"abaaaaba", 5},
    {"abaaaabb", 6},
    {"abaaabaa", 4},
    {"abaaabab", 5},
    {"abaaabba", 6},
    {"abaaabbb", 6},
    {"abaabaaa", 5},
    {"abaabaab", 4},
    {"abaababa", 4},
    {"abaababb", 5},
    {"abaabbaa", 5},
    {"abaabbab", 5},
    {"abaabbba", 6},
    {"abaabbbb", 6},
    {"ababaaaa", 5},
    {"ababaaab", 5},
    {"ababaaba", 4},
    {"ababaabb", 5},
    {"abababaa", 5},
    {"abababab", 3},
    {"abababba", 5},
    {"abababbb", 5},
    {"ababbaaa", 6},
    {"ababbaab", 5},
    {"ababbaba", 5},
    {"ababbabb", 4},
    {"ababbbaa", 6},
    {"ababbbab", 5},
    {"ababbbba", 6},
    {"ababbbbb", 5},
    {"abbaaaaa", 6},
    {"abbaaaab", 6},
    {"abbaaaba", 6},
    {"abbaaabb", 5},
    {"abbaabaa", 5},
    {"abbaabab", 5},
    {"abbaabba", 4},
    {"abbaabbb", 5},
    {"abbabaaa", 6},
    {"abbabaab", 5},
    {"abbababa", 5},
    {"abbababb", 4},
    {"abbabbaa", 5},
    {"abbabbab", 4},
    {"abbabbba", 5},
    {"abbabbbb", 4},
    {"abbbaaaa", 6},
    {"abbbaaab", 6},
    {"abbbaaba", 6},
    {"abbbaabb", 5},
    {"abbbabaa", 6},
    {"abbbabab", 5},
    {"abbbabba", 5},
    {"abbbabbb", 4},
    {"abbbbaaa", 6},
    {"abbbbaab", 6},
    {"abbbbaba", 6},
    {"abbbbabb", 4},
    {"abbbbbaa", 6},
    {"abbbbbab", 5},
    {"abbbbbba", 5},
    {"abbbbbbb", 5},
    {"baaaaaaa", 5},
    {"baaaaaab", 5},
    {"baaaaaba", 5},
    {"baaaaabb", 6},
    {"baaaabaa", 4},
    {"baaaabab", 6},
    {"baaaabba", 6},
    {"baaaabbb", 6},
    {"baaabaaa", 4},
    {"baaabaab", 5},
    {"baaababa", 5},
    {"baaababb", 6},
    {"baaabbaa", 5},
    {"baaabbab", 6},
    {"baaabbba", 6},
    {"baaabbbb", 6},
    {"baabaaaa", 4},
    {"baabaaab", 5},
    {"baabaaba", 4},
    {"baabaabb", 5},
    {"baababaa", 4},
    {"baababab", 5},
    {"baababba", 5},
    {"baababbb", 6},
    {"baabbaaa", 5},
    {"baabbaab", 4},
    {"baabbaba", 5},
    {"baabbabb", 5},
    {"baabbbaa", 5},
    {"baabbbab", 6},
    {"baabbbba", 6},
    {"baabbbbb", 6},
    {"babaaaaa", 5},
    {"babaaaab", 6},
    {"babaaaba", 5},
    {"babaaabb", 6},
    {"babaabaa", 4},
    {"babaabab", 5},
    {"babaabba", 5},
    {"babaabbb", 6},
    {"bababaaa", 5},
    {"bababaab", 5},
    {"babababa", 3},
    {"babababb", 5},
    {"bababbaa", 5},
    {"bababbab", 4},
    {"bababbba", 5},
    {"bababbbb", 5},
    {"babbaaaa", 6},
    {"babbaaab", 6},
    {"babbaaba", 5},
    {"babbaabb", 5},
    {"babbabaa", 5},
    {"babbabab", 4},
    {"babbabba", 4},
    {"babbabbb", 5},
    {"babbbaaa", 6},
    {"babbbaab", 6},
    {"babbbaba", 5},
    {"babbbabb", 4},
    {"babbbbaa", 6},
    {"babbbbab", 5},
    {"babbbbba", 5},
    {"babbbbbb", 5},
    {"bbaaaaaa", 5},
    {"bbaaaaab", 6},
    {"bbaaaaba", 6},
    {"bbaaaabb", 5},
    {"bbaaabaa", 5},
    {"bbaaabab", 6},
    {"bbaaabba", 5},
    {"bbaaabbb", 6},
    {"bbaabaaa", 5},
    {"bbaabaab", 5},
    {"bbaababa", 5},
    {"bbaababb", 6},
    {"bbaabbaa", 4},
    {"bbaabbab", 5},
    {"bbaabbba", 5},
    {"bbaabbbb", 5},
    {"bbabaaaa", 6},
    {"bbabaaab", 6},
    {"bbabaaba", 5},
    {"bbabaabb", 6},
    {"bbababaa", 5},
    {"bbababab", 5},
    {"bbababba", 4},
    {"bbababbb", 5},
    {"bbabbaaa", 5},
    {"bbabbaab", 5},
    {"bbabbaba", 4},
    {"bbabbabb", 4},
    {"bbabbbaa", 5},
    {"bbabbbab", 4},
    {"bbabbbba", 4},
    {"bbabbbbb", 5},
    {"bbbaaaaa", 6},
    {"bbbaaaab", 6},
    {"bbbaaaba", 6},
    {"bbbaaabb", 6},
    {"bbbaabaa", 5},
    {"bbbaabab", 6},
    {"bbbaabba", 5},
    {"bbbaabbb", 5},
    {"bbbabaaa", 6},
    {"bbbabaab", 6},
    {"bbbababa", 5},
    {"bbbababb", 5},
    {"bbbabbaa", 5},
    {"bbbabbab", 5},
    {"bbbabbba", 4},
    {"bbbabbbb", 5},
    {"bbbbaaaa", 5},
    {"bbbbaaab", 6},
    {"bbbbaaba", 6},
    {"bbbbaabb", 5},
    {"bbbbabaa", 6},
    {"bbbbabab", 5},
    {"bbbbabba", 4},
    {"bbbbabbb", 5},
    {"bbbbbaaa", 6},
    {"bbbbbaab", 6},
    {"bbbbbaba", 5},
    {"bbbbbabb", 5},
    {"bbbbbbaa", 5},
    {"bbbbbbab", 5},
    {"bbbbbbba", 5},
    {"bbbbbbbb", 3},
};

static auto earnest(std::string str) -> int64_t {
    auto const cmd = "bin/earnest " + str;
    int64_t c = -1;
    auto handle = popen(cmd.c_str(), "r");
    auto const n = fscanf(handle, "%ld", &c);
    pclose(handle);
    if (n != 1) {
        c = std::size(str) - 1;
    }
    return c;
}

TEST_CASE("strings", "[string]") {
    SECTION("binary-strings") {
        for (auto const &[s,c]: table) {
            REQUIRE(thurber(s) == c);
        }
    }
}
